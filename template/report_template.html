<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>{{ title }}</title>
<style>
@page { margin: 14mm 16mm; }                        /* margini pagina */
body { margin: 0; font-family: Arial, sans-serif; font-size: 12pt; color:#111; }

.center { text-align:center; }
.header-hero { width:100%; max-height: 30mm; object-fit: contain; margin-bottom: 6mm; }
.logo-hero   { height: 40mm; }               /* logo centrale PIÙ grande */
.meta        { color:#444; }

.first {
  position: relative;
  min-height: 260mm;                      /* area utile di una A4 con margini */
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  text-align: center;
  padding-top: 22mm;                      /* riserva spazio per la barra in alto */
}
/* barra loghi solo nel frontespizio, attaccata in alto */
.front-top {
  position: absolute; top: 0; left: 0; right: 0;
  height: 20mm;
  display: flex; align-items: center; justify-content: center;
  padding: 0 10mm;
}
.front-top img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}
.section { margin: 18px 0; }
table { width:100%; border-collapse: collapse; }
th, td { border:1px solid #ddd; padding:8px 10px; }
th { background: #f5f5f5; text-align:left; }
.img-full { width:100%; }

/* rimuoviamo i page break forzati */
.page-break { page-break-before: always; }
</style>
</head>
<body>
  <!-- PRIMA PAGINA: header grande + logo + titoli, tutto centrato -->
  <section class="first">
    {% if header_filename %}
    <div class="front-top">
      <img src="{{ header_filename }}" alt="Header">
    </div>
    {% endif %}

    {% if logo_filename %}<img class="logo-hero" src="{{ logo_filename }}">{% endif %}
    <div class="meta" style="margin-top:4mm; font-size:14pt;">
      <strong>{{ company or "GID Lab" }}</strong> – {{ date }}
    </div>
    <h1 style="margin-top:6mm;">{{ title }}</h1>

    <div class="meta" style="margin-top:6mm;">
      <div>Template: <span class="muted">{{ template_name }}</span></div>
      <div>Seriale UUT: <strong>{{ uut_serial }}</strong></div>
    </div>
  </section>

  <!-- PAGINA 2 -->
  <div class="page-break"></div>

  <main class="content">
    <!-- Risultato del test -->
    <section>
      <h2>Risultato del test</h2>
      <table>
        <thead>
          <tr>
            <th>Nome Test</th>
            <th>Risultato Test</th>
            <th>Valore di riferimento</th>
            <th>Tolleranza</th>
            <th>Valore misurato</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ test_name }}</td>
            <td><strong>{{ result_text }}</strong></td>
            <td>{{ ref_value_fmt }}</td>
            <td>{{ tol_fmt }}</td>
            <td>{{ meas_value_fmt }}</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Dati allegati -->
    <section class="section">
  <h2>Dati allegati</h2>
  <div>File log: <code>{{ log_xlsx_basename }}</code></div>
  {% if graphs and graphs|length>0 %}
    <div style="margin-top:6px;">Grafici (Pdcx vs Vdcx):</div>
    <ul>
      {% for g in graphs %}
        <li>{{ g.ch }}{% if g.html %} — <a href="{{ g.html|basename }}">interattivo</a>{% endif %}</li>
      {% endfor %}
    </ul>
    {% for g in graphs %}
      {% if g.png %}<img src="{{ g.png|basename }}" class="img-full" style="margin-top:10px;">{% endif %}
    {% endfor %}
  {% endif %}
</section>


    <!-- Allarmi -->
    <section class="section">
      <h2>Allarmi</h2>
      {% if alarms|length>0 %}
      <table>
        <thead><tr><th>Timestamp</th><th>Codice</th><th>Fonte</th></tr></thead>
        <tbody>
          {% for a in alarms %}
            <tr><td>{{ a.ts }}</td><td>{{ a.code }}</td><td>{{ a.src }}</td></tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <div class="muted">Nessun allarme disponibile.</div>
      {% endif %}
    </section>
  </main>
</body>
</html>